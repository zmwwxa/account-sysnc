# 剑网三角色配置同步工具

一个基于 Electron + React + Flask 的桌面应用程序，用于快速复制剑网三角色的 userdata 配置（界面、插件、宏等）从源角色到目标角色。

**作者**: 孤月伴云流

## 功能特性

### 核心功能
- **快速路径识别**：拖入游戏快捷方式或手动选择，自动识别游戏路径
- **批量同步**：一次性将源角色配置同步到多个目标角色
- **智能搜索**：支持角色名、账号、大区、服务器的实时搜索和过滤
- **跨账号支持**：支持不同账号、不同大区、不同服务器间的配置复制

### 备份管理
- **自动备份**：复制前自动备份目标角色数据
- **无限备份**：不限制备份数量，保留所有历史备份
- **备份还原**：支持将任意备份还原到任意角色
- **备份搜索**：还原时支持搜索目标角色，自动选择第一个匹配项
- **打开备份位置**：一键打开系统备份文件夹

### 用户体验
- **现代化界面**：基于 React 的美观易用界面
- **实时反馈**：操作过程中的实时状态提示
- **详细报告**：复制完成后显示详细的成功和失败信息
- **配置保存**：自动保存游戏路径，下次启动自动加载
- **打开角色文件夹**：支持直接打开源角色或目标角色的配置文件夹

## 技术栈

### 前端
- **框架**: React 18.2
- **构建工具**: Vite 5.0
- **桌面框架**: Electron 28
- **开发工具**: concurrently, wait-on

### 后端
- **框架**: Flask (Python)
- **API端口**: http://127.0.0.1:5000
- **架构模式**: RESTful API

### 通信
- **前后端**: REST API (fetch)
- **进程间通信**: Electron IPC

## 项目结构

```
account-sysnc/
├── frontend/                    # 前端项目
│   ├── src/
│   │   ├── components/          # React 组件
│   │   │   ├── PathSelector.jsx         # 路径选择器
│   │   │   ├── RoleSelector.jsx         # 角色选择器（源/目标）
│   │   │   ├── CopyOptions.jsx          # 复制选项
│   │   │   ├── BackupManager.jsx        # 备份管理器
│   │   │   └── SuccessDialog.jsx        # 成功对话框
│   │   ├── api.js               # API 服务层
│   │   ├── App.jsx              # 主应用组件
│   │   └── App.css              # 样式文件
│   ├── electron/
│   │   └── main.js              # Electron 主进程
│   └── package.json             # 前端依赖配置
│
├── backend/                     # 后端项目
│   ├── __init__.py              # 包初始化
│   ├── app.py                   # Flask 应用主入口
│   ├── models.py                # 数据模型（RoleInfo, BackupInfo）
│   ├── path_resolver.py         # 路径解析器
│   ├── role_scanner.py          # 角色扫描器
│   ├── role_copier.py           # 角色复制器
│   ├── backup_manager.py        # 备份管理器
│   └── config_manager.py        # 配置管理器
│
├── backups/                     # 备份文件存储目录
└── README.md                    # 本文档
```

## 系统要求

- **操作系统**: Windows 10/11
- **Node.js**: 14.0 或更高版本
- **Python**: 3.7 或更高版本
- **游戏客户端**: 剑网三（标准版或高清版）

## 安装步骤

### 1. 克隆或下载项目

```bash
git clone <repository-url>
cd account-sysnc
```

### 2. 安装前端依赖

```bash
cd frontend
npm install
```

### 3. 安装后端依赖

```bash
cd ../backend
pip install flask flask-cors
```

### 4. 启动应用

#### 开发模式

```bash
cd frontend
npm start
```

此命令会同时启动：
- Vite 开发服务器（端口 5173）
- Python Flask 后端（端口 5000）
- Electron 桌面应用

#### 生产模式

```bash
# 构建前端
cd frontend
npm run build

# 打包应用
npm run dist
```

## 使用指南

### 第一步：设置游戏路径

**方式一：拖放快捷方式（推荐）**
1. 找到桌面或开始菜单中的剑网三快捷方式
2. 拖入工具窗口的拖放区域
3. 工具会自动解析并识别游戏路径

**方式二：手动选择**
1. 点击手动选择游戏目录按钮
2. 选择游戏安装根目录（通常是 SeasunGame 文件夹）
3. 工具会自动查找 userdata 目录

### 第二步：选择源角色

1. 在源角色下拉框中选择要复制配置的角色
2. 支持搜索：输入角色名、账号、大区或服务器进行筛选
3. 自动选择第一个匹配的角色
4. 可点击打开文件夹查看源角色配置

### 第三步：选择目标角色

1. 在目标角色列表中选择一个或多个角色
2. 支持搜索：输入关键词快速筛选
3. 按住 Ctrl 可多选角色
4. 选中的角色会高亮显示
5. 可点击打开文件夹查看目标角色配置

### 第四步：开始同步

1. 确认自动备份选项已勾选（强烈推荐）
2. 点击开始复制按钮
3. 等待复制完成
4. 查看详细的复制报告

### 备份管理

1. 点击主界面右下角的备份管理按钮
2. 查看所有历史备份，包含：
   - 备份角色信息
   - 备份创建时间
   - 备份文件大小
3. 点击还原恢复某个备份：
   - 搜索目标角色
   - 选择目标角色
   - 确认还原操作
4. 点击删除移除不需要的备份
5. 点击打开备份位置查看所有备份文件

## 配置说明

### 游戏目录结构

工具会自动识别以下路径结构：

```
SeasunGame/
└── Game/
    └── JX3/
        └── bin/
            ├── zhcn/              # 标准版
            │   └── userdata/
            └── zhcn_hd/           # 高清版
                └── userdata/
                    └── [账号名]/   # 本地数据账号文件夹
                        ├── 电信区/
                        │   └── [服务器]/
                        │       └── [角色名]/
                        │           ├── custom.dat
                        │           ├── hotkey.data
                        │           └── ...
                        └── 双线区/
```

### 备份目录

备份文件存储在项目根目录的 `backups/` 文件夹中：

```
backups/
└── [账号]_[大区]_[服务器]_[角色]_[时间戳]/
    ├── custom.dat
    ├── hotkey.data
    ├── userpreferences.jx3dat
    └── ...
```

### 配置文件

应用配置保存在 `backend/jx3_sync_config.json`：

```json
{
  "userdata_path": "D:/SeasunGame/Game/JX3/bin/zhcn_hd/userdata",
  "game_path": "D:/SeasunGame"
}
```

## API 接口文档

### 路径相关
- `POST /api/path/parse-shortcut` - 解析快捷方式
- `POST /api/path/resolve-game` - 解析游戏路径

### 角色相关
- `GET /api/roles/scan` - 扫描所有角色
- `GET /api/roles/filters` - 获取过滤器选项

### 复制相关
- `POST /api/copy/validate` - 验证复制操作
- `POST /api/copy/single` - 复制到单个角色
- `POST /api/copy/multiple` - 复制到多个角色

### 备份相关
- `GET /api/backup/get-path` - 获取备份目录路径
- `GET /api/backup/list` - 列出所有备份
- `POST /api/backup/restore` - 还原备份
- `POST /api/backup/delete` - 删除备份

### 配置相关
- `GET /api/config/get` - 获取配置
- `POST /api/config/set` - 设置配置

### 系统相关
- `GET /api/health` - 健康检查
- `POST /api/folder/open` - 打开文件夹

## 注意事项

### 安全提示

1. **关闭游戏**：建议在同步前完全关闭游戏客户端，避免文件冲突
2. **备份重要**：首次使用建议手动备份重要角色数据
3. **测试优先**：建议先在测试角色上尝试，确认无误后再大规模使用

### 兼容性说明

1. **跨账号复制**：不同账号间复制时，部分账号相关配置可能不兼容
2. **插件数据**：某些插件的数据可能依赖特定角色ID，复制后需要重新配置
3. **服务器差异**：不同服务器间的某些配置可能存在差异

### 数据说明

工具复制的配置文件包括：
- `custom.dat` - 界面布局和设置
- `custom.dat.addon` - 插件配置
- `hotkey.data` - 快捷键设置
- `hotkey_newback*.txt` - 快捷键备份
- `userpreferences.jx3dat` - 用户偏好设置
- `userpreferences/` - 偏好设置子文件夹
- `JT.data` - 宏数据
- `JT_MacroContent.data` - 宏内容
- 其他相关配置文件

## 故障排除

### 问题：找不到 userdata 目录

**原因**：游戏路径识别失败

**解决方案**：
1. 确认游戏已正常安装
2. 检查游戏版本（标准版是 `zhcn`，高清版是 `zhcn_hd`）
3. 手动导航到 userdata 目录确认路径
4. 使用手动选择功能

### 问题：无法拖放快捷方式

**原因**：权限不足或浏览器安全限制

**解决方案**：
1. 使用手动选择游戏目录功能
2. 确保 Electron 应用有读取文件权限

### 问题：复制后配置没有生效

**原因**：游戏缓存或文件锁定

**解决方案**：
1. 确认游戏已完全关闭（包括后台进程）
2. 重启游戏
3. 检查目标角色文件夹是否有文件被覆盖
4. 检查复制报告中的错误信息

### 问题：备份还原失败

**原因**：备份文件损坏或权限不足

**解决方案**：
1. 检查备份文件夹是否完整
2. 确认目标角色路径存在
3. 关闭游戏后再尝试还原

### 问题：启动时端口占用

**原因**：Flask 服务端口 5000 或 Vite 端口 5173 被占用

**解决方案**：
```bash
# Windows - 查找并关闭占用端口的进程
netstat -ano | findstr :5000
taskkill /PID <进程ID> /F

netstat -ano | findstr :5173
taskkill /PID <进程ID> /F
```

## 开发说明

### 调试模式

开发模式下会自动打开 Chrome DevTools，可以查看：
- 前端 Console 日志
- Network 请求
- React 组件树
- 性能分析

### 修改代码后

**前端代码修改**：
- Vite 支持热更新，保存后自动刷新

**后端代码修改**：
- 需要重启 Python 进程
- 或在 Electron main.js 中使用 `-B` 参数禁用 .pyc 缓存

### 添加新功能

1. 前端组件：在 `frontend/src/components/` 添加新组件
2. API 接口：在 `frontend/src/api.js` 添加 API 方法
3. 后端接口：在 `backend/app.py` 添加路由
4. 业务逻辑：在 `backend/` 相应模块添加功能

## 版本历史

### v1.0.3 (2025-12-14)
- 优化游戏路径查找算法，采用双向遍历策略（向上和向下）查找 userdata 目录
- 提高路径定位的准确性，支持更多游戏安装目录结构
- 添加详细的调试日志，便于问题排查
- 更新应用程序图标

### v1.0.2 (2025-12-13)
- 添加使用说明功能
- 优化进程管理

### v1.0.1 (2025-12-13)
- 修复应用关闭时后台进程残留问题

### v1.0.0 (2025-12-13)
- 初始版本发布
- Electron + React + Flask 架构
- 角色配置同步功能
- 无限备份功能
- 备份还原功能
- 搜索和过滤功能
- 打开文件夹功能
- 现代化界面设计

## 贡献指南

欢迎提交 Issue 和 Pull Request。

提交代码前请确保：
1. 代码符合项目风格
2. 功能经过测试
3. 更新相关文档

## 许可证

本项目为开源免费软件，仅供学习交流使用。

## 免责声明

本工具仅用于方便玩家管理游戏配置，不涉及游戏数据修改或作弊行为。使用本工具造成的任何问题由使用者自行承担。建议使用前备份重要数据。

---

**如有问题或建议，欢迎联系作者：孤月伴云流**
